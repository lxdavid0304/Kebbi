# 如何檢查和修正機器人配置

## 問題診斷步驟

### 步驟 1: 執行診斷工具
```bash
python diagnose_config.py
```

這個工具會告訴您：
- 程式正在使用哪個 config.py 檔案
- 當前的 IP 和 Port 設定
- TCP 連線是否成功

### 步驟 2: 找到正確的配置檔案

根據診斷結果，您需要編輯的檔案可能是以下其中之一：

**選項 A**: `realsense_planner/config.py` (根目錄下)
**選項 B**: `Kebbi/realsense_planner/config.py`

您的 `capture_d435_dynamic_world_occ.py` 檔案從 `realsense_planner` 導入，所以應該編輯：
```
realsense_planner/config.py
```

### 步驟 3: 修改配置

用文字編輯器打開 `realsense_planner/config.py`，找到並修改這兩行：

```python
# 找到這兩行（大約在第 60-61 行）
ROBOT_TCP_IP = "172.20.10.8"      # ← 改成您的機器人 IP
ROBOT_TCP_PORT = 8888             # ← 改成您的機器人 Port
```

### 步驟 4: 如何找到機器人的 IP 地址

#### 方法 1: 在機器人上查看
1. 在機器人的設定中查看網路設定
2. 記下 IP 地址（例如: 192.168.1.100）

#### 方法 2: 用 ping 測試
```bash
# Linux/Mac
ping 機器人名稱.local

# 或掃描網路
nmap -sn 192.168.1.0/24  # 替換成您的網段
```

#### 方法 3: 檢查路由器
1. 登入路由器管理介面
2. 查看連接的設備列表
3. 找到機器人的 IP

### 步驟 5: 驗證配置

修改完配置後，再次執行診斷工具：
```bash
python diagnose_config.py
```

應該看到：
```
[3] 測試 TCP 連線...
   目標: 您的機器人IP:8888
   ✅ TCP 連接埠可達！

[4] 測試 RobotTCPClient...
   啟動連線...
   ✅ RobotTCPClient 連線成功！（0.5秒）
```

### 步驟 6: 重新執行主程式

```bash
python capture_d435_dynamic_world_occ.py
```

現在左上角應該顯示：
```
TCP: 已連線 ✓
ODOM: 已連線 ✓
```

## 常見問題

### Q: 為什麼顯示「連線中...」而不是問號？
A: 問號不是正常訊息。如果看到「連線中...」，表示：
- TCP 客戶端已初始化
- 但還沒連線成功
- 可能 IP 或 Port 錯誤

### Q: 我的機器人在 WiFi，但找不到 IP
A: 確認：
1. 機器人和電腦在同一個 WiFi 網路
2. 在機器人上啟動了 TCP 伺服器程式
3. 防火牆沒有阻擋連線

### Q: 如何查看終端的錯誤訊息？
A: 在終端運行時，注意這些訊息：
```
[tcp] ✅ connected to IP:PORT  ← 連線成功
[tcp] connect failed: ...      ← 連線失敗（會說明原因）
```

### Q: 我修改了 config.py 但沒有效果？
A: 可能的原因：
1. 修改了錯誤的 config.py（檢查診斷工具輸出）
2. 需要重新啟動程式
3. Python 快取問題，試試刪除 `__pycache__` 目錄

## 快速檢查清單

- [ ] 執行 `python diagnose_config.py`
- [ ] 確認正在使用的 config.py 路徑
- [ ] 修改正確的 ROBOT_TCP_IP
- [ ] 修改正確的 ROBOT_TCP_PORT（通常是 8888）
- [ ] 確認機器人已啟動並在網路上
- [ ] 重新執行診斷工具驗證
- [ ] 執行主程式測試

## 需要幫助？

如果還是無法連線，請執行：
```bash
python diagnose_config.py > debug_output.txt 2>&1
```

然後提供 `debug_output.txt` 的內容。